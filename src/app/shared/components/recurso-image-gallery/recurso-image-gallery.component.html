<div class="image-gallery-container">
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h6 class="mb-0">
        <i class="bi bi-images"></i> Galería de Imágenes
      </h6>
      <button
        type="button"
        *ngIf="!soloLectura"
        class="btn btn-sm btn-primary"
        (click)="fileInput.click()"
        [disabled]="subiendoImagen"
      >
        <i class="bi bi-cloud-upload"></i> Subir Imagen
      </button>
      <input
        #fileInput
        type="file"
        accept="image/*"
        style="display: none"
        (change)="onFileSelected($event)"
      />
    </div>

    <div class="card-body">
      <!-- Loading spinner -->
      <div *ngIf="cargando" class="text-center py-4">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
      </div>

      <!-- No images message -->
      <div *ngIf="!cargando && imagenes.length === 0" class="text-center py-4 text-muted">
        <i class="bi bi-image" style="font-size: 3rem;"></i>
        <p class="mt-2">No hay imágenes aún</p>
        <p *ngIf="!soloLectura" class="small">Haz clic en "Subir Imagen" para agregar fotos</p>
      </div>

      <!-- Images grid -->
      <div *ngIf="!cargando && imagenes.length > 0" class="row g-3">
        <div *ngFor="let imagen of imagenes" class="col-md-4 col-lg-3">
          <div class="image-card" [class.principal]="imagen.esPrincipal">
            <!-- Principal badge -->
            <span *ngIf="imagen.esPrincipal" class="badge bg-success position-absolute top-0 start-0 m-2">
              <i class="bi bi-star-fill"></i> Principal
            </span>

            <!-- Image -->
            <div class="image-wrapper" (click)="verImagen(imagen)">
              <img [src]="imagen.url" [alt]="imagen.descripcion || 'Imagen'" class="img-fluid">
            </div>

            <!-- Image info and actions -->
            <div class="image-info">
              <p class="small mb-1 text-truncate" [title]="imagen.descripcion || imagen.nombre">
                {{ imagen.descripcion || imagen.nombre || 'Sin descripción' }}
              </p>

              <div *ngIf="!soloLectura" class="btn-group btn-group-sm w-100">
                <button
                  type="button"
                  class="btn btn-outline-primary"
                  (click)="verImagen(imagen)"
                  title="Ver imagen"
                >
                  <i class="bi bi-eye"></i>
                </button>
                <button
                  type="button"
                  *ngIf="!imagen.esPrincipal"
                  class="btn btn-outline-success"
                  (click)="establecerPrincipal(imagen)"
                  title="Establecer como principal"
                >
                  <i class="bi bi-star"></i>
                </button>
                <button
                  type="button"
                  class="btn btn-outline-danger"
                  (click)="eliminarImagen(imagen)"
                  title="Eliminar"
                >
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Image count -->
      <div *ngIf="!cargando && imagenes.length > 0" class="mt-3 text-muted small">
        <i class="bi bi-info-circle"></i>
        {{ imagenes.length }} imagen(es) en total
      </div>
    </div>
  </div>
</div>
