<app-public-navbar></app-public-navbar>

<div class="catalogo-container">
  <!-- Header -->
  <div class="page-header">
    <h1 class="page-title">Servicios Premium</h1>
    <p class="page-subtitle">Complementa tu estadía con actividades increíbles</p>
  </div>

  <!-- Filtros -->
  <mat-card class="filters-card">
    <mat-card-content>
      <div class="filters-grid">
        <!-- Búsqueda -->
        <mat-form-field appearance="outline" class="filter-field-large">
          <mat-label>Buscar</mat-label>
          <mat-icon matPrefix>search</mat-icon>
          <input
            matInput
            [(ngModel)]="filtroBusqueda"
            (ngModelChange)="aplicarFiltros()"
            placeholder="Nombre o descripción...">
        </mat-form-field>

        <!-- Ordenar -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Ordenar por</mat-label>
          <mat-icon matPrefix>sort</mat-icon>
          <mat-select
            [(ngModel)]="ordenarPor"
            (ngModelChange)="aplicarFiltros()">
            <mat-option value="nombre">Nombre</mat-option>
            <mat-option value="precio-asc">Precio: Menor a Mayor</mat-option>
            <mat-option value="precio-desc">Precio: Mayor a Menor</mat-option>
            <mat-option value="duracion">Duración</mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Limpiar -->
        <button
          mat-stroked-button
          color="primary"
          class="clear-button"
          (click)="limpiarFiltros()">
          <mat-icon>clear_all</mat-icon>
          Limpiar
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Resultados -->
  <div class="results-info">
    <p class="results-text">
      <strong>{{ serviciosFiltrados.length }}</strong> servicio(s) encontrado(s)
    </p>
  </div>

  <!-- Loading -->
  <div *ngIf="cargando" class="loading-container">
    <mat-spinner diameter="60"></mat-spinner>
    <p class="loading-text">Cargando servicios...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!cargando && serviciosFiltrados.length === 0" class="empty-state">
    <mat-icon class="empty-icon">stars</mat-icon>
    <p class="empty-text">No se encontraron servicios con los filtros seleccionados</p>
    <button mat-raised-button color="primary" (click)="limpiarFiltros()">
      Ver todos los servicios
    </button>
  </div>

  <!-- Grid de Servicios -->
  <div class="servicios-grid" *ngIf="!cargando && serviciosFiltrados.length > 0">
    <mat-card *ngFor="let servicio of serviciosPaginados" class="servicio-card" matRipple>
      <!-- Imagen -->
      <div class="card-image-container">
        <img *ngIf="obtenerImagenPrincipal(servicio)"
             [src]="obtenerImagenPrincipal(servicio)"
             [alt]="servicio.nombre"
             class="card-image">
        <div *ngIf="!obtenerImagenPrincipal(servicio)" class="card-image-placeholder">
          <mat-icon class="placeholder-icon">stars</mat-icon>
        </div>
        <mat-chip class="status-badge" color="accent">Disponible</mat-chip>
      </div>

      <mat-card-content class="card-content">
        <div class="card-header">
          <h3 class="card-title">{{ servicio.nombre }}</h3>
        </div>

        <p class="card-description">
          {{ servicio.descripcion || 'Servicio de primera calidad para tu disfrute' }}
        </p>

        <!-- Características -->
        <div class="card-features">
          <div class="feature-item">
            <mat-icon class="feature-icon">schedule</mat-icon>
            <span class="feature-text">{{ servicio.duracionBloqueMinutos || 60 }} minutos</span>
          </div>
          <div class="feature-item">
            <mat-icon class="feature-icon">people</mat-icon>
            <span class="feature-text">Capacidad: {{ servicio.capacidadMaxima }} personas</span>
          </div>
          <div class="feature-item" *ngIf="servicio.requiereSupervision">
            <mat-icon class="feature-icon">verified_user</mat-icon>
            <span class="feature-text">Requiere supervisión</span>
          </div>
        </div>

        <!-- Precio -->
        <div class="card-price-container">
          <div class="card-price">
            ${{ formatearPrecio(servicio.precioPorUnidad || 0) }}
          </div>
        </div>
      </mat-card-content>

      <mat-card-actions class="card-actions">
        <button mat-stroked-button color="primary" class="action-button" (click)="verDetalle(servicio)">
          <mat-icon>visibility</mat-icon>
          Ver Detalles
        </button>
        <button mat-raised-button color="primary" class="action-button" (click)="reservar(servicio)">
          <mat-icon>event_available</mat-icon>
          Reservar
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Paginación Material -->
  <mat-card *ngIf="totalPaginas > 1" class="pagination-card">
    <mat-card-content class="pagination-content">
      <button
        mat-icon-button
        [disabled]="paginaActual === 1"
        (click)="cambiarPagina(paginaActual - 1)">
        <mat-icon>chevron_left</mat-icon>
      </button>

      <div class="page-numbers">
        <button
          *ngFor="let pagina of [].constructor(totalPaginas); let i = index"
          mat-button
          [class.active-page]="paginaActual === i + 1"
          (click)="cambiarPagina(i + 1)">
          {{ i + 1 }}
        </button>
      </div>

      <button
        mat-icon-button
        [disabled]="paginaActual === totalPaginas"
        (click)="cambiarPagina(paginaActual + 1)">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </mat-card-content>
  </mat-card>
</div>

<!-- Footer -->
<footer class="footer">
  <div class="footer-container">
    <p class="footer-text">© 2025 Cabañas & Servicios. Todos los derechos reservados.</p>
  </div>
</footer>
