<app-public-navbar></app-public-navbar>

<div class="catalogo-container">
  <!-- Header -->
  <div class="page-header">
    <h1 class="page-title">Nuestras Cabañas</h1>
    <p class="page-subtitle">Encuentra el lugar perfecto para tu estadía</p>
  </div>

  <!-- Filtros -->
  <mat-card class="filters-card">
    <mat-card-content>
      <div class="filters-grid">
        <!-- Búsqueda -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Buscar</mat-label>
          <mat-icon matPrefix>search</mat-icon>
          <input
            matInput
            [(ngModel)]="filtroBusqueda"
            (ngModelChange)="aplicarFiltros()"
            placeholder="Nombre o descripción...">
        </mat-form-field>

        <!-- Capacidad -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Capacidad mínima</mat-label>
          <mat-icon matPrefix>people</mat-icon>
          <mat-select
            [(ngModel)]="filtroCapacidad"
            (ngModelChange)="aplicarFiltros()">
            <mat-option [value]="0">Todas</mat-option>
            <mat-option *ngFor="let cap of capacidadesDisponibles" [value]="cap">
              {{ cap }}+ personas
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Ordenar -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Ordenar por</mat-label>
          <mat-icon matPrefix>sort</mat-icon>
          <mat-select
            [(ngModel)]="ordenarPor"
            (ngModelChange)="aplicarFiltros()">
            <mat-option value="nombre">Nombre</mat-option>
            <mat-option value="precio-asc">Precio: Menor a Mayor</mat-option>
            <mat-option value="precio-desc">Precio: Mayor a Menor</mat-option>
            <mat-option value="capacidad">Capacidad</mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Limpiar -->
        <button
          mat-stroked-button
          color="primary"
          class="clear-button"
          (click)="limpiarFiltros()">
          <mat-icon>clear_all</mat-icon>
          Limpiar
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Resultados -->
  <div class="results-info">
    <p class="results-text">
      <strong>{{ cabanasFiltradas.length }}</strong> cabaña(s) encontrada(s)
    </p>
  </div>

  <!-- Loading -->
  <div *ngIf="cargando" class="loading-container">
    <mat-spinner diameter="60"></mat-spinner>
    <p class="loading-text">Cargando cabañas...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!cargando && cabanasFiltradas.length === 0" class="empty-state">
    <mat-icon class="empty-icon">cottage</mat-icon>
    <p class="empty-text">No se encontraron cabañas con los filtros seleccionados</p>
    <button mat-raised-button color="primary" (click)="limpiarFiltros()">
      Ver todas las cabañas
    </button>
  </div>

  <!-- Grid de Cabañas -->
  <div class="cabanas-grid" *ngIf="!cargando && cabanasFiltradas.length > 0">
    <mat-card *ngFor="let cabana of cabanasPaginadas" class="cabana-card" matRipple>
      <!-- Imagen -->
      <div class="card-image-container">
        <img *ngIf="obtenerImagenPrincipal(cabana)"
             [src]="obtenerImagenPrincipal(cabana)"
             [alt]="cabana.nombre"
             class="card-image">
        <div *ngIf="!obtenerImagenPrincipal(cabana)" class="card-image-placeholder">
          <mat-icon class="placeholder-icon">cottage</mat-icon>
        </div>
        <mat-chip class="status-badge" color="accent">Disponible</mat-chip>
      </div>

      <mat-card-content class="card-content">
        <div class="card-header">
          <h3 class="card-title">{{ cabana.nombre }}</h3>
        </div>

        <p class="card-description">
          {{ cabana.descripcion || 'Cabaña confortable y equipada para tu estadía' }}
        </p>

        <!-- Características -->
        <div class="card-features">
          <div class="feature-item">
            <mat-icon class="feature-icon">people</mat-icon>
            <span class="feature-text">{{ cabana.capacidadPersonas }} personas</span>
          </div>
          <div class="feature-item" *ngIf="cabana.numeroHabitaciones">
            <mat-icon class="feature-icon">bed</mat-icon>
            <span class="feature-text">{{ cabana.numeroHabitaciones }} habitaciones</span>
          </div>
          <div class="feature-item" *ngIf="cabana.numeroBanos">
            <mat-icon class="feature-icon">bathroom</mat-icon>
            <span class="feature-text">{{ cabana.numeroBanos }} baños</span>
          </div>
        </div>

        <!-- Precio -->
        <div class="card-price-container">
          <div class="card-price">
            ${{ formatearPrecio(cabana.precioPorUnidad || 0) }}
            <span class="price-unit">/noche</span>
          </div>
        </div>
      </mat-card-content>

      <mat-card-actions class="card-actions">
        <button mat-stroked-button color="primary" class="action-button" (click)="verDetalle(cabana)">
          <mat-icon>visibility</mat-icon>
          Ver Detalles
        </button>
        <button mat-raised-button color="primary" class="action-button" (click)="reservar(cabana)">
          <mat-icon>event_available</mat-icon>
          Reservar
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Paginación Material -->
  <mat-card *ngIf="totalPaginas > 1" class="pagination-card">
    <mat-card-content class="pagination-content">
      <button
        mat-icon-button
        [disabled]="paginaActual === 1"
        (click)="cambiarPagina(paginaActual - 1)">
        <mat-icon>chevron_left</mat-icon>
      </button>

      <div class="page-numbers">
        <button
          *ngFor="let pagina of [].constructor(totalPaginas); let i = index"
          mat-button
          [class.active-page]="paginaActual === i + 1"
          (click)="cambiarPagina(i + 1)">
          {{ i + 1 }}
        </button>
      </div>

      <button
        mat-icon-button
        [disabled]="paginaActual === totalPaginas"
        (click)="cambiarPagina(paginaActual + 1)">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </mat-card-content>
  </mat-card>
</div>

<!-- Footer -->
<footer class="footer">
  <div class="footer-container">
    <p class="footer-text">© 2025 Cabañas & Servicios. Todos los derechos reservados.</p>
  </div>
</footer>
