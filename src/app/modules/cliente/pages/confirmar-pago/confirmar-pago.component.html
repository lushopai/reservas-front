<div class="confirmar-pago-container py-4">
  <div class="container">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a routerLink="/cliente/mis-reservas">Mis Reservas</a></li>
        <li class="breadcrumb-item active">Confirmar Pago</li>
      </ol>
    </nav>

    <!-- Título -->
    <div class="row">
      <div class="col-12 mb-4">
        <h2 class="text-primary">
          <i class="fas fa-credit-card me-2"></i>
          Confirmar Pago de Reserva
        </h2>
      </div>
    </div>

    <div *ngIf="cargando" class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-3">Cargando información de la reserva...</p>
    </div>

    <div *ngIf="!cargando && reserva" class="row">
      <!-- Columna Izquierda: Resumen de Reserva -->
      <div class="col-lg-5 mb-4">
        <div class="card shadow-sm">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0">
              <i class="fas fa-file-invoice me-2"></i>
              Resumen de Reserva
            </h5>
          </div>
          <div class="card-body">
            <!-- ID -->
            <div class="mb-3">
              <small class="text-muted">ID de Reserva</small>
              <h4 class="text-primary">#{{ reserva.id }}</h4>
            </div>

            <hr>

            <!-- Recurso -->
            <div class="mb-3">
              <small class="text-muted d-block">Recurso</small>
              <p class="mb-0"><strong>{{ reserva.nombreRecurso }}</strong></p>
              <small class="badge bg-secondary">{{ reserva.tipoReserva }}</small>
            </div>

            <!-- Fechas -->
            <div class="mb-3">
              <small class="text-muted d-block">Período</small>
              <p class="mb-1">
                <i class="fas fa-calendar-alt me-2 text-primary"></i>
                <strong>Inicio:</strong> {{ reserva.fechaInicio | date:'dd/MM/yyyy HH:mm' }}
              </p>
              <p class="mb-0">
                <i class="fas fa-calendar-check me-2 text-success"></i>
                <strong>Fin:</strong> {{ reserva.fechaFin | date:'dd/MM/yyyy HH:mm' }}
              </p>
            </div>

            <hr>

            <!-- Desglose de Precios -->
            <div class="mb-3">
              <div class="d-flex justify-content-between mb-2">
                <span>Precio Base:</span>
                <span><strong>{{ formatearPrecio(reserva.precioBase) }}</strong></span>
              </div>
              <div class="d-flex justify-content-between mb-2" *ngIf="reserva.precioItems > 0">
                <span>Items Adicionales:</span>
                <span><strong>{{ formatearPrecio(reserva.precioItems) }}</strong></span>
              </div>
            </div>

            <hr>

            <!-- Total -->
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0">Total a Pagar:</h5>
              <h4 class="text-success mb-0">{{ formatearPrecio(reserva.precioTotal) }}</h4>
            </div>

            <!-- Observaciones -->
            <div *ngIf="reserva.observaciones" class="mt-3 alert alert-info">
              <small class="text-muted d-block">Observaciones:</small>
              <p class="mb-0">{{ reserva.observaciones }}</p>
            </div>
          </div>
        </div>

        <!-- Información de Seguridad -->
        <div class="alert alert-success mt-3">
          <i class="fas fa-lock me-2"></i>
          <strong>Pago seguro</strong>
          <p class="mb-0 small">Tus datos están protegidos con encriptación SSL</p>
        </div>
      </div>

      <!-- Columna Derecha: Formulario de Pago -->
      <div class="col-lg-7">
        <div class="card shadow-sm">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">
              <i class="fas fa-dollar-sign me-2"></i>
              Información de Pago
            </h5>
          </div>
          <div class="card-body">
            <form [formGroup]="formPago" (ngSubmit)="confirmarPago()">

              <!-- Método de Pago -->
              <div class="mb-4">
                <label class="form-label fw-bold">Método de Pago</label>
                <div class="row g-2">
                  <div class="col-6 col-md-3" *ngFor="let metodo of metodosPago">
                    <input
                      type="radio"
                      class="btn-check"
                      [id]="'metodo-' + metodo.valor"
                      formControlName="metodoPago"
                      [value]="metodo.valor">
                    <label
                      class="btn btn-outline-primary w-100"
                      [for]="'metodo-' + metodo.valor">
                      <i class="fas {{ metodo.icono }} d-block mb-1"></i>
                      <small>{{ metodo.nombre }}</small>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Campos para Tarjeta -->
              <div *ngIf="mostrarCamposTarjeta">
                <h6 class="text-primary mb-3">
                  <i class="fas fa-credit-card me-2"></i>
                  Datos de la Tarjeta
                </h6>

                <!-- Número de Tarjeta -->
                <div class="mb-3">
                  <label for="numeroTarjeta" class="form-label">Número de Tarjeta</label>
                  <input
                    type="text"
                    class="form-control form-control-lg"
                    id="numeroTarjeta"
                    formControlName="numeroTarjeta"
                    placeholder="1234 5678 9012 3456"
                    maxlength="19"
                    (input)="formatearNumeroTarjeta($event)"
                    [class.is-invalid]="formPago.get('numeroTarjeta')?.invalid && formPago.get('numeroTarjeta')?.touched">
                  <div class="invalid-feedback">
                    Por favor ingrese un número de tarjeta válido
                  </div>
                </div>

                <!-- Nombre del Titular -->
                <div class="mb-3">
                  <label for="nombreTitular" class="form-label">Nombre del Titular</label>
                  <input
                    type="text"
                    class="form-control"
                    id="nombreTitular"
                    formControlName="nombreTitular"
                    placeholder="Como aparece en la tarjeta"
                    [class.is-invalid]="formPago.get('nombreTitular')?.invalid && formPago.get('nombreTitular')?.touched">
                  <div class="invalid-feedback">
                    El nombre del titular es requerido
                  </div>
                </div>

                <!-- Fecha y CVV -->
                <div class="row">
                  <div class="col-6">
                    <label for="fechaExpiracion" class="form-label">Fecha de Expiración</label>
                    <input
                      type="text"
                      class="form-control"
                      id="fechaExpiracion"
                      formControlName="fechaExpiracion"
                      placeholder="MM/YY"
                      maxlength="5"
                      (input)="formatearFechaExpiracion($event)"
                      [class.is-invalid]="formPago.get('fechaExpiracion')?.invalid && formPago.get('fechaExpiracion')?.touched">
                    <div class="invalid-feedback">
                      Formato: MM/YY
                    </div>
                  </div>
                  <div class="col-6">
                    <label for="cvv" class="form-label">CVV</label>
                    <input
                      type="text"
                      class="form-control"
                      id="cvv"
                      formControlName="cvv"
                      placeholder="123"
                      maxlength="4"
                      [class.is-invalid]="formPago.get('cvv')?.invalid && formPago.get('cvv')?.touched">
                    <div class="invalid-feedback">
                      Requerido
                    </div>
                  </div>
                </div>
              </div>

              <!-- Campos para Transferencia -->
              <div *ngIf="mostrarCamposTransferencia">
                <h6 class="text-primary mb-3">
                  <i class="fas fa-exchange-alt me-2"></i>
                  Datos de la Transferencia
                </h6>

                <div class="alert alert-info">
                  <strong>Instrucciones:</strong>
                  <p class="mb-2 small">Realice la transferencia y luego ingrese el número de referencia:</p>
                  <ul class="small mb-0">
                    <li>Banco: Banco Estado</li>
                    <li>Cuenta Corriente: 12345678</li>
                    <li>RUT: 76.123.456-7</li>
                    <li>Monto: <strong>{{ formatearPrecio(reserva.precioTotal) }}</strong></li>
                  </ul>
                </div>

                <!-- Número de Transferencia -->
                <div class="mb-3">
                  <label for="numeroTransferencia" class="form-label">Número de Transferencia</label>
                  <input
                    type="text"
                    class="form-control"
                    id="numeroTransferencia"
                    formControlName="numeroTransferencia"
                    placeholder="Ej: 987654321"
                    [class.is-invalid]="formPago.get('numeroTransferencia')?.invalid && formPago.get('numeroTransferencia')?.touched">
                  <div class="invalid-feedback">
                    El número de transferencia es requerido
                  </div>
                </div>

                <!-- Banco Emisor -->
                <div class="mb-3">
                  <label for="bancoEmisor" class="form-label">Banco Emisor</label>
                  <select
                    class="form-select"
                    id="bancoEmisor"
                    formControlName="bancoEmisor"
                    [class.is-invalid]="formPago.get('bancoEmisor')?.invalid && formPago.get('bancoEmisor')?.touched">
                    <option value="">Seleccione un banco</option>
                    <option value="Banco Estado">Banco Estado</option>
                    <option value="Banco de Chile">Banco de Chile</option>
                    <option value="Santander">Santander</option>
                    <option value="BCI">BCI</option>
                    <option value="Scotiabank">Scotiabank</option>
                    <option value="Itaú">Itaú</option>
                    <option value="Otro">Otro</option>
                  </select>
                  <div class="invalid-feedback">
                    Seleccione el banco emisor
                  </div>
                </div>
              </div>

              <!-- Mensaje para Efectivo -->
              <div *ngIf="formPago.get('metodoPago')?.value === 'EFECTIVO'" class="alert alert-warning">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Pago en Efectivo:</strong>
                <p class="mb-0 small">
                  Deberá realizar el pago en efectivo al momento de llegar. Su reserva quedará confirmada pendiente de pago.
                </p>
              </div>

              <!-- Botones -->
              <div class="d-flex justify-content-between mt-4">
                <button
                  type="button"
                  class="btn btn-outline-secondary"
                  (click)="volver()"
                  [disabled]="procesandoPago">
                  <i class="fas fa-arrow-left me-2"></i>
                  Volver
                </button>
                <button
                  type="submit"
                  class="btn btn-success btn-lg"
                  [disabled]="formPago.invalid || procesandoPago">
                  <span *ngIf="!procesandoPago">
                    <i class="fas fa-check me-2"></i>
                    Confirmar Pago
                  </span>
                  <span *ngIf="procesandoPago">
                    <span class="spinner-border spinner-border-sm me-2"></span>
                    Procesando...
                  </span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
