<div class="dashboard-container">

  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <div>
        <h1 class="page-title">
          <mat-icon>dashboard</mat-icon>
          Dashboard Administrativo
        </h1>
        <p class="page-subtitle">
          Bienvenido, <strong>{{ currentUser?.username }}</strong>
          <mat-chip *ngIf="currentUser?.roles?.[0]">{{ currentUser?.roles?.[0]?.name }}</mat-chip>
        </p>
      </div>
      <div class="header-actions">
        <button mat-stroked-button (click)="loadDashboardData()" [disabled]="loading">
          <mat-icon>refresh</mat-icon>
          Actualizar
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="60"></mat-spinner>
    <p class="loading-text">Cargando estadísticas del dashboard...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading" class="dashboard-content">

    <!-- KPI Cards -->
    <div class="kpi-grid">

      <!-- Total Usuarios -->
      <mat-card class="kpi-card blue-gradient" (click)="verUsuarios()">
        <mat-card-content>
          <div class="kpi-icon">
            <mat-icon>group</mat-icon>
          </div>
          <div class="kpi-info">
            <div class="kpi-value">{{ stats?.totalUsuarios || 0 }}</div>
            <div class="kpi-label">Total Usuarios</div>
            <div class="kpi-detail">
              <mat-icon>trending_up</mat-icon>
              <span>+{{ stats?.usuariosNuevos || 0 }} este mes</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Total Reservas -->
      <mat-card class="kpi-card green-gradient" (click)="verReservas()">
        <mat-card-content>
          <div class="kpi-icon">
            <mat-icon>event</mat-icon>
          </div>
          <div class="kpi-info">
            <div class="kpi-value">{{ stats?.totalReservas || 0 }}</div>
            <div class="kpi-label">Total Reservas</div>
            <div class="kpi-detail">
              <mat-icon>pending</mat-icon>
              <span>{{ stats?.reservasPendientes || 0 }} pendientes</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Ingresos del Mes -->
      <mat-card class="kpi-card purple-gradient">
        <mat-card-content>
          <div class="kpi-icon">
            <mat-icon>payments</mat-icon>
          </div>
          <div class="kpi-info">
            <div class="kpi-value">{{ formatCurrency(stats?.ingresosMes || 0) }}</div>
            <div class="kpi-label">Ingresos del Mes</div>
            <div class="kpi-detail">
              <mat-icon>today</mat-icon>
              <span>{{ formatCurrency(stats?.ingresosHoy || 0) }} hoy</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Ocupación -->
      <mat-card class="kpi-card orange-gradient">
        <mat-card-content>
          <div class="kpi-icon">
            <mat-icon>cottage</mat-icon>
          </div>
          <div class="kpi-info">
            <div class="kpi-value">{{ porcentajeOcupacion }}%</div>
            <div class="kpi-label">Ocupación</div>
            <div class="kpi-detail">
              <mat-icon>check_circle</mat-icon>
              <span>{{ stats?.cabanasDisponibles || 0 }} disponibles</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">

      <!-- Confirmadas -->
      <mat-card class="stat-mini-card">
        <mat-card-content>
          <div class="stat-mini-content">
            <div class="stat-mini-info">
              <div class="stat-mini-label">Confirmadas</div>
              <div class="stat-mini-value">{{ stats?.reservasConfirmadas || 0 }}</div>
            </div>
            <div class="stat-mini-icon success">
              <mat-icon>check_circle</mat-icon>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Pendientes -->
      <mat-card class="stat-mini-card">
        <mat-card-content>
          <div class="stat-mini-content">
            <div class="stat-mini-info">
              <div class="stat-mini-label">Pendientes</div>
              <div class="stat-mini-value">{{ stats?.reservasPendientes || 0 }}</div>
            </div>
            <div class="stat-mini-icon warning">
              <mat-icon>schedule</mat-icon>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- En Curso -->
      <mat-card class="stat-mini-card">
        <mat-card-content>
          <div class="stat-mini-content">
            <div class="stat-mini-info">
              <div class="stat-mini-label">En Curso</div>
              <div class="stat-mini-value">{{ stats?.reservasEnCurso || 0 }}</div>
            </div>
            <div class="stat-mini-icon info">
              <mat-icon>directions_run</mat-icon>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Canceladas -->
      <mat-card class="stat-mini-card">
        <mat-card-content>
          <div class="stat-mini-content">
            <div class="stat-mini-info">
              <div class="stat-mini-label">Canceladas</div>
              <div class="stat-mini-value">{{ stats?.reservasCanceladas || 0 }}</div>
            </div>
            <div class="stat-mini-icon error">
              <mat-icon>cancel</mat-icon>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

    </div>

  

    <!-- Quick Actions & Usuarios Grid -->
    <div class="content-grid">

      <!-- Quick Actions -->
      <mat-card class="quick-actions-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>bolt</mat-icon>
            Acciones Rápidas
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-nav-list>
            <a mat-list-item routerLink="/admin/usuarios">
              <mat-icon matListItemIcon style="color: #2196f3">group</mat-icon>
              <span matListItemTitle>Gestionar Usuarios</span>
            </a>

            <mat-divider></mat-divider>

            <a mat-list-item routerLink="/admin/reservas">
              <mat-icon matListItemIcon color="accent">event</mat-icon>
              <span matListItemTitle>Ver Reservas</span>
              <span matListItemMeta *ngIf="stats?.reservasPendientes">
                <mat-chip class="chip-warning">{{ stats?.reservasPendientes }}</mat-chip>
              </span>
            </a>

            <mat-divider></mat-divider>

            <a mat-list-item routerLink="/admin/cabanas">
              <mat-icon matListItemIcon style="color: #ff9800">cottage</mat-icon>
              <span matListItemTitle>Gestionar Cabañas</span>
            </a>

            <mat-divider></mat-divider>

            <a mat-list-item routerLink="/admin/servicios">
              <mat-icon matListItemIcon style="color: #9c27b0">star</mat-icon>
              <span matListItemTitle>Gestionar Servicios</span>
            </a>

            <mat-divider></mat-divider>

            <a mat-list-item routerLink="/admin/inventario">
              <mat-icon matListItemIcon style="color: #607d8b">inventory</mat-icon>
              <span matListItemTitle>Inventario</span>
            </a>

            <mat-divider></mat-divider>

            <a mat-list-item routerLink="/admin/pagos">
              <mat-icon matListItemIcon style="color: #4caf50">payments</mat-icon>
              <span matListItemTitle>Pagos</span>
            </a>

            <mat-divider></mat-divider>

            <a mat-list-item routerLink="/admin/disponibilidad">
              <mat-icon matListItemIcon style="color: #2196f3">calendar_month</mat-icon>
              <span matListItemTitle>Disponibilidad</span>
            </a>
          </mat-nav-list>
        </mat-card-content>
      </mat-card>

      <!-- Usuarios Recientes -->
      <mat-card class="usuarios-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>person_add</mat-icon>
          Nuevos Usuarios
        </mat-card-title>
        <button mat-button color="primary" (click)="verUsuarios()">
          Ver todos
          <mat-icon>arrow_forward</mat-icon>
        </button>
      </mat-card-header>
      <mat-card-content>

        <div *ngIf="usuariosDataSource.data.length === 0" class="empty-state">
          <mat-icon>people_outline</mat-icon>
          <p>No hay usuarios recientes</p>
        </div>

        <div *ngIf="usuariosDataSource.data.length > 0">
          <table mat-table [dataSource]="usuariosDataSource" class="usuarios-table">

            <!-- Avatar Column -->
            <ng-container matColumnDef="avatar">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let usuario">
                <mat-icon class="usuario-avatar">account_circle</mat-icon>
              </td>
            </ng-container>

            <!-- Info Column -->
            <ng-container matColumnDef="info">
              <th mat-header-cell *matHeaderCellDef>Usuario</th>
              <td mat-cell *matCellDef="let usuario">
                <div class="usuario-info">
                  <div class="usuario-name">{{ usuario.nombreCompleto || usuario.username }}</div>
                  <div class="usuario-email">{{ usuario.email }}</div>
                </div>
              </td>
            </ng-container>

            <!-- Fecha Column -->
            <ng-container matColumnDef="fecha">
              <th mat-header-cell *matHeaderCellDef>Registrado</th>
              <td mat-cell *matCellDef="let usuario">
                <span class="usuario-date">{{ usuario.fechaRegistro | date:'short' }}</span>
              </td>
            </ng-container>

            <!-- Acciones Column -->
            <ng-container matColumnDef="acciones">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let usuario">
                <button mat-icon-button color="primary" (click)="verUsuario(usuario.id)" matTooltip="Ver perfil">
                  <mat-icon>chevron_right</mat-icon>
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="['avatar', 'info', 'fecha', 'acciones']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['avatar', 'info', 'fecha', 'acciones']" class="usuario-row"></tr>

          </table>

          <mat-paginator
            #usuariosPaginator
            [pageSize]="5"
            [pageSizeOptions]="[5, 10, 20]"
            showFirstLastButtons
            class="table-paginator">
          </mat-paginator>
        </div>

      </mat-card-content>
    </mat-card>

    </div>

  </div>

</div>
