<div class="cabana-form-container">
  <!-- Header -->
  <div class="form-header">
    <div>
      <h2 class="form-title">{{ isEditMode ? 'Editar Cabaña' : 'Nueva Cabaña' }}</h2>
      <p class="form-subtitle">Complete el formulario con la información de la cabaña</p>
    </div>
    <button mat-icon-button (click)="volver()" matTooltip="Volver">
      <mat-icon>arrow_back</mat-icon>
    </button>
  </div>

  <!-- Loading spinner -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
  </div>

  <!-- Formulario -->
  <form *ngIf="!loading" [formGroup]="cabanaForm" (ngSubmit)="onSubmit()" class="form-content">
    <!-- Información General -->
    <mat-card class="form-section">
      <mat-card-header>
        <mat-card-title>
          <mat-icon class="section-icon">info</mat-icon>
          Información General
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="form-grid">
          <!-- Nombre -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Nombre <span class="required">*</span></mat-label>
            <input matInput formControlName="nombre" placeholder="Ej: Cabaña El Roble" />
            <mat-error *ngIf="cabanaForm.get('nombre')?.hasError('required')">
              El nombre es obligatorio
            </mat-error>
            <mat-error *ngIf="cabanaForm.get('nombre')?.hasError('maxlength')">
              Máximo 100 caracteres
            </mat-error>
          </mat-form-field>

          <!-- Tipo -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Tipo <span class="required">*</span></mat-label>
            <mat-select formControlName="tipoCabana">
              <mat-option *ngFor="let tipo of tiposCabana" [value]="tipo">
                {{ getTipoCabanaLabel(tipo) }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="cabanaForm.get('tipoCabana')?.hasError('required')">
              El tipo es obligatorio
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Descripción -->
        <mat-form-field appearance="outline" class="form-field full-width">
          <mat-label>Descripción <span class="required">*</span></mat-label>
          <textarea
            matInput
            formControlName="descripcion"
            rows="3"
            placeholder="Describe las características principales de la cabaña..."
          ></textarea>
          <mat-hint align="end">{{ cabanaForm.get('descripcion')?.value?.length || 0 }}/1000</mat-hint>
          <mat-error *ngIf="cabanaForm.get('descripcion')?.hasError('required')">
            La descripción es obligatoria
          </mat-error>
          <mat-error *ngIf="cabanaForm.get('descripcion')?.hasError('maxlength')">
            Máximo 1000 caracteres
          </mat-error>
        </mat-form-field>
      </mat-card-content>
    </mat-card>

    <!-- Características -->
    <mat-card class="form-section">
      <mat-card-header>
        <mat-card-title>
          <mat-icon class="section-icon">home</mat-icon>
          Características
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="form-grid-4">
          <!-- Capacidad -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Capacidad <span class="required">*</span></mat-label>
            <input matInput type="number" formControlName="capacidadPersonas" placeholder="6" min="1" />
            <mat-hint>Personas</mat-hint>
            <mat-error *ngIf="cabanaForm.get('capacidadPersonas')?.hasError('required')">
              Ingrese la capacidad
            </mat-error>
            <mat-error *ngIf="cabanaForm.get('capacidadPersonas')?.hasError('min')">
              Mínimo 1
            </mat-error>
          </mat-form-field>

          <!-- Habitaciones -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Habitaciones <span class="required">*</span></mat-label>
            <input matInput type="number" formControlName="numeroHabitaciones" placeholder="3" min="1" />
            <mat-error *ngIf="cabanaForm.get('numeroHabitaciones')?.hasError('required')">
              Ingrese cantidad
            </mat-error>
            <mat-error *ngIf="cabanaForm.get('numeroHabitaciones')?.hasError('min')">
              Mínimo 1
            </mat-error>
          </mat-form-field>

          <!-- Baños -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Baños <span class="required">*</span></mat-label>
            <input matInput type="number" formControlName="numeroBanos" placeholder="2" min="1" />
            <mat-error *ngIf="cabanaForm.get('numeroBanos')?.hasError('required')">
              Ingrese cantidad
            </mat-error>
            <mat-error *ngIf="cabanaForm.get('numeroBanos')?.hasError('min')">
              Mínimo 1
            </mat-error>
          </mat-form-field>

          <!-- Metros cuadrados -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Metros² <span class="required">*</span></mat-label>
            <input matInput type="number" formControlName="metrosCuadrados" placeholder="80.5" step="0.1" min="1" />
            <mat-error *ngIf="cabanaForm.get('metrosCuadrados')?.hasError('required')">
              Ingrese los m²
            </mat-error>
            <mat-error *ngIf="cabanaForm.get('metrosCuadrados')?.hasError('min')">
              Mínimo 1
            </mat-error>
          </mat-form-field>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Precio y Estado -->
    <mat-card class="form-section">
      <mat-card-header>
        <mat-card-title>
          <mat-icon class="section-icon">payments</mat-icon>
          Precio y Estado
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="form-grid">
          <!-- Precio -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Precio por Día <span class="required">*</span></mat-label>
            <span matPrefix>$&nbsp;</span>
            <input matInput type="number" formControlName="precioPorUnidad" placeholder="50000" min="1" />
            <mat-error *ngIf="cabanaForm.get('precioPorUnidad')?.hasError('required')">
              El precio es obligatorio
            </mat-error>
            <mat-error *ngIf="cabanaForm.get('precioPorUnidad')?.hasError('min')">
              Mínimo $1
            </mat-error>
          </mat-form-field>

          <!-- Estado -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Estado <span class="required">*</span></mat-label>
            <mat-select formControlName="estado">
              <mat-option *ngFor="let estado of estados" [value]="estado">
                {{ estado }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="cabanaForm.get('estado')?.hasError('required')">
              El estado es obligatorio
            </mat-error>
          </mat-form-field>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Servicios Incluidos -->
    <mat-card class="form-section">
      <mat-card-header>
        <mat-card-title>
          <mat-icon class="section-icon">local_offer</mat-icon>
          Servicios Incluidos
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <mat-form-field appearance="outline" class="form-field full-width">
          <mat-label>Servicios y Amenidades</mat-label>
          <textarea
            matInput
            formControlName="serviciosIncluidos"
            rows="4"
            placeholder="Ej: WiFi, TV Cable, Cocina equipada, Calefacción, Parrilla, Estacionamiento..."
          ></textarea>
          <mat-hint align="end">{{ cabanaForm.get('serviciosIncluidos')?.value?.length || 0 }}/2000</mat-hint>
          <mat-hint>Opcional: Describe los servicios incluidos</mat-hint>
        </mat-form-field>
      </mat-card-content>
    </mat-card>

    <!-- Galería de Imágenes (solo en modo edición) -->
    <div *ngIf="isEditMode && cabanaId" class="form-section">
      <app-recurso-image-gallery [recursoId]="cabanaId"></app-recurso-image-gallery>
    </div>

    <!-- Botones -->
    <div class="form-actions">
      <button
        mat-stroked-button
        type="button"
        (click)="volver()"
        [disabled]="submitting"
      >
        Cancelar
      </button>
      <button
        mat-raised-button
        color="primary"
        type="submit"
        [disabled]="submitting"
      >
        <mat-icon *ngIf="!submitting" class="me-2">save</mat-icon>
        <mat-spinner diameter="20" *ngIf="submitting" class="me-2"></mat-spinner>
        {{ isEditMode ? 'Actualizar' : 'Crear' }} Cabaña
      </button>
    </div>
  </form>
</div>
